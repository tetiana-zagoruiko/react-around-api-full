{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _slicedToArray from\"/Users/tanya/Dev/react-around-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import{Route,Switch,useHistory}from'react-router-dom';import Main from'./Main.js';import Header from'./Header.js';import Register from'./Register.js';import Login from'./Login.js';import ProtectedRoute from'./ProtectedRoute';import EditProfilePopup from'./EditProfilePopup.js';import EditAvatarPopup from'./EditAvatarPopup.js';import AddPlacePopup from'./AddPlacePopup.js';import PopupWithForm from'./PopupWithForm.js';import InfoTooltip from'./InfoTooltip.js';import imageSuccessPath from\"../images/success.png\";import imageOopsPath from'../images/oops.png';import ImagePopup from'./ImagePopup.js';import*as auth from'../auth.js';import api from'../utils/Api.js';import CurrentUserContext from'../contexts/CurrentUserContext.js';function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditProfilePopupOpen=_React$useState2[0],setIsEditProfilePopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isAddPlacePopupOpen=_React$useState4[0],setIsAddPlacePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditAvatarPopupOpen=_React$useState6[0],setIsEditAvatarPopupOpen=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isImagePopupOpen=_React$useState8[0],setIsImagePopupOpen=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isInfoTooltipOpen=_React$useState10[0],setInfoTooltipOpen=_React$useState10[1];var _React$useState11=React.useState(\"\"),_React$useState12=_slicedToArray(_React$useState11,2),infoTooltipText=_React$useState12[0],setInfoTooltipText=_React$useState12[1];var _React$useState13=React.useState(\"#\"),_React$useState14=_slicedToArray(_React$useState13,2),infoTooltipImage=_React$useState14[0],setInfoTooltipImage=_React$useState14[1];var _React$useState15=React.useState([]),_React$useState16=_slicedToArray(_React$useState15,2),cards=_React$useState16[0],setCards=_React$useState16[1];var _React$useState17=React.useState(\"\"),_React$useState18=_slicedToArray(_React$useState17,2),selectedCardLink=_React$useState18[0],setSelectedCardLink=_React$useState18[1];var _React$useState19=React.useState(\"\"),_React$useState20=_slicedToArray(_React$useState19,2),selectedCardName=_React$useState20[0],setSelectedCardName=_React$useState20[1];var _React$useState21=React.useState({}),_React$useState22=_slicedToArray(_React$useState21,2),currentUser=_React$useState22[0],setCurrentUser=_React$useState22[1];var _React$useState23=React.useState(''),_React$useState24=_slicedToArray(_React$useState23,2),userMail=_React$useState24[0],setUserMail=_React$useState24[1];var _React$useState25=React.useState(false),_React$useState26=_slicedToArray(_React$useState25,2),loggedIn=_React$useState26[0],setLoggedIn=_React$useState26[1];var history=useHistory();React.useEffect(function(){api.getUserInfo().then(function(res){setCurrentUser(res);}).catch(function(err){return console.log(err);});api.getCardList().then(function(res){setCards(res);}).catch(function(err){return console.log(err);});},[]);React.useEffect(function(){var jwt=localStorage.getItem('jwt');if(jwt){auth.checkToken(jwt).then(function(res){setLoggedIn(true);setUserMail(res.data.email);history.push(\"/\");}).catch(function(err){return console.log(err);});}},[loggedIn,history]);var onSignOut=function onSignOut(){localStorage.removeItem('jwt');setLoggedIn(false);};function handleCardLike(card){var isLiked=card.card.likes.some(function(i){return i._id===currentUser._id;});api.changeLikeCardStatus(card.card._id,!isLiked).then(function(newCard){var newCards=cards.map(function(c){return c._id===newCard._id?newCard:c;});setCards(newCards);}).catch(function(err){return console.log(err);});}function handleCardDelete(cardID){api.removeCard(cardID).then(function(res){var newCards=cards.filter(function(card){return card._id!==cardID;});setCards(newCards);}).catch(function(err){return console.log(err);});}function closeAllPopups(){setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setIsEditAvatarPopupOpen(false);setIsEditAvatarPopupOpen(false);setIsImagePopupOpen(false);setInfoTooltipOpen(false);}function handleUpdateUser(_ref){var name=_ref.name,title=_ref.title;api.setUserInfo({name:name,title:title}).then(function(res){closeAllPopups();setCurrentUser(res);}).catch(function(err){return console.log(err);});}function handleUpdateAvatar(avatar){api.setUserAvatar(avatar).then(function(res){closeAllPopups();setCurrentUser(res);}).catch(function(err){return console.log(err);});}function handleAddPlaceSubmit(_ref2){var name=_ref2.name,link=_ref2.link;api.addCard({name:name,link:link}).then(function(res){var addedCardList=cards.concat(res);setCards(addedCardList);closeAllPopups();}).catch(function(err){return console.log(err);});}function openingInfoTooltip(kind){if(kind===false){setInfoTooltipText(\"Oops, something went wrong! Please try again.\");setInfoTooltipImage(imageOopsPath);setInfoTooltipOpen(true);}else{setInfoTooltipText(\"Success! You have now been registered.\");setInfoTooltipImage(imageSuccessPath);setInfoTooltipOpen(true);}}function handleRegister(password,email){auth.register(password,email).then(function(res){console.log(res);if(!res||res.statusCode===400){openingInfoTooltip(false);}else{openingInfoTooltip(true);history.push(\"/login\");return res;}}).catch(function(err){return openingInfoTooltip(false);});}function handleLogin(password,email){auth.authorize(password,email).then(function(data){if(data.token){setLoggedIn(true);history.push(\"/\");}else{openingInfoTooltip(false);}}).catch(function(err){return openingInfoTooltip(false);});}return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"page\",children:[/*#__PURE__*/_jsx(\"main\",{children:/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsxs(Route,{path:\"/signin\",children:[/*#__PURE__*/_jsx(Header,{headerText:\"Sign up\",headerLink:\"/signup\"}),/*#__PURE__*/_jsx(Login,{handleLogin:handleLogin,openingInfoTooltip:openingInfoTooltip,infoTooltipIsOpen:isInfoTooltipOpen,onClose:closeAllPopups,infoTooltipText:infoTooltipText,infoTooltipImage:infoTooltipImage})]}),/*#__PURE__*/_jsxs(Route,{path:\"/signup\",children:[/*#__PURE__*/_jsx(Header,{headerText:\"Log in\",headerLink:\"/signin\"}),/*#__PURE__*/_jsx(Register,{openingInfoTooltip:openingInfoTooltip,infoTooltipIsOpen:isInfoTooltipOpen,onClose:closeAllPopups,infoTooltipText:infoTooltipText,infoTooltipImage:infoTooltipImage,handleRegister:handleRegister})]}),/*#__PURE__*/_jsx(ProtectedRoute,{path:\"/\",loggedIn:loggedIn,onEditProfile:function onEditProfile(){setIsEditProfilePopupOpen(true);},onAddPlace:function onAddPlace(){setIsAddPlacePopupOpen(true);},onEditAvatar:function onEditAvatar(){setIsEditAvatarPopupOpen(true);},onCardClick:function onCardClick(card){setIsImagePopupOpen(true);setSelectedCardLink(card.card.link);setSelectedCardName(card.card.name);},editProfileIsOpen:isEditProfilePopupOpen,editAvatarIsOpen:isEditAvatarPopupOpen,addPlaceIsOpen:isAddPlacePopupOpen,imagePopupIsOpen:isImagePopupOpen,imageLink:selectedCardLink,imageName:selectedCardName,onClose:closeAllPopups,onCardLike:handleCardLike,onCardDelete:handleCardDelete,cards:cards,onSignOut:onSignOut,userMail:userMail,component:Main})]})}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isInfoTooltipOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(InfoTooltip,{onClose:closeAllPopups,isOpen:isInfoTooltipOpen,infoTooltipText:infoTooltipText,infoTooltipImage:infoTooltipImage}),/*#__PURE__*/_jsx(ImagePopup,{onClose:closeAllPopups,imagePopupIsOpened:isImagePopupOpen,cardName:selectedCardName,cardLink:selectedCardLink}),/*#__PURE__*/_jsx(PopupWithForm,{name:\"delete-card\",buttonText:\"Yes\",title:\"Are you sure?\",children:/*#__PURE__*/_jsx(React.Fragment,{})})]})});}export default App;","map":{"version":3,"sources":["/Users/tanya/Dev/react-around-api-full/frontend/src/components/App.js"],"names":["React","Route","Switch","useHistory","Main","Header","Register","Login","ProtectedRoute","EditProfilePopup","EditAvatarPopup","AddPlacePopup","PopupWithForm","InfoTooltip","imageSuccessPath","imageOopsPath","ImagePopup","auth","api","CurrentUserContext","App","useState","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isImagePopupOpen","setIsImagePopupOpen","isInfoTooltipOpen","setInfoTooltipOpen","infoTooltipText","setInfoTooltipText","infoTooltipImage","setInfoTooltipImage","cards","setCards","selectedCardLink","setSelectedCardLink","selectedCardName","setSelectedCardName","currentUser","setCurrentUser","userMail","setUserMail","loggedIn","setLoggedIn","history","useEffect","getUserInfo","then","res","catch","err","console","log","getCardList","jwt","localStorage","getItem","checkToken","data","email","push","onSignOut","removeItem","handleCardLike","card","isLiked","likes","some","i","_id","changeLikeCardStatus","newCard","newCards","map","c","handleCardDelete","cardID","removeCard","filter","closeAllPopups","handleUpdateUser","name","title","setUserInfo","handleUpdateAvatar","avatar","setUserAvatar","handleAddPlaceSubmit","link","addCard","addedCardList","concat","openingInfoTooltip","kind","handleRegister","password","register","statusCode","handleLogin","authorize","token"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Route, Switch, useHistory } from 'react-router-dom';\n\nimport Main from './Main.js';\nimport Header from './Header.js';\nimport Register from './Register.js';\nimport Login from './Login.js';\nimport ProtectedRoute from './ProtectedRoute';\nimport EditProfilePopup from './EditProfilePopup.js';\nimport EditAvatarPopup from './EditAvatarPopup.js';\nimport AddPlacePopup from './AddPlacePopup.js';\nimport PopupWithForm from './PopupWithForm.js';\nimport InfoTooltip from './InfoTooltip.js';\nimport imageSuccessPath from \"../images/success.png\";\nimport imageOopsPath from '../images/oops.png';\nimport ImagePopup from './ImagePopup.js';\n\nimport * as auth from '../auth.js';\nimport api from '../utils/Api.js';\nimport CurrentUserContext from '../contexts/CurrentUserContext.js';\n\n\nfunction App() {\n\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n  const [isImagePopupOpen, setIsImagePopupOpen] = React.useState(false);\n  const [isInfoTooltipOpen, setInfoTooltipOpen] = React.useState(false);\n  const [infoTooltipText, setInfoTooltipText] = React.useState(\"\");\n  const [infoTooltipImage, setInfoTooltipImage] = React.useState(\"#\");\n\n  const [cards, setCards] = React.useState([]);\n  const [selectedCardLink, setSelectedCardLink] = React.useState(\"\");\n  const [selectedCardName, setSelectedCardName] = React.useState(\"\");\n\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [userMail, setUserMail] = React.useState('');\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const history = useHistory();\n\n  React.useEffect(() => {\n    api.getUserInfo()\n      .then(res => {\n        setCurrentUser(res);\n      })\n      .catch(err => console.log(err));\n    api.getCardList()\n      .then(res => {\n        setCards(res);\n      })\n      .catch(err => console.log(err))\n  }, [])\n\n\n  React.useEffect(() => {\n    const jwt = localStorage.getItem('jwt');\n    if (jwt) {\n      auth.checkToken(jwt)\n      .then((res) => {\n          setLoggedIn(true);\n          setUserMail(res.data.email);\n          history.push(\"/\");\n      })\n      .catch(err => console.log(err));\n    }\n  }, [loggedIn, history]);\n\n  const onSignOut = () => {\n    localStorage.removeItem('jwt');\n    setLoggedIn(false);\n  }\n\n  function handleCardLike(card) {\n    const isLiked = card.card.likes.some(i => i._id === currentUser._id);\n    api.changeLikeCardStatus(card.card._id, !isLiked)\n      .then((newCard) => {\n      const newCards = cards.map((c) => c._id === newCard._id ? newCard : c);\n      setCards(newCards);\n    })\n      .catch(err => console.log(err));\n  }\n\n  function handleCardDelete(cardID) {\n    api.removeCard(cardID)\n    .then(res => {\n      const newCards = cards.filter(card => card._id !== cardID);\n      setCards(newCards);\n    })\n    .catch(err => console.log(err));\n  }\n\n  function closeAllPopups() {\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsImagePopupOpen(false);\n    setInfoTooltipOpen(false);\n  }\n\n  function handleUpdateUser({name, title}) {\n    api.setUserInfo({ name, title})\n      .then(res => {\n        closeAllPopups();\n        setCurrentUser(res);\n      })\n      .catch(err => console.log(err))\n  }\n\n  function handleUpdateAvatar(avatar) {\n    api.setUserAvatar(avatar)\n      .then(res => {\n        closeAllPopups();\n        setCurrentUser(res);\n      })\n      .catch(err => console.log(err))\n  }\n\n  function handleAddPlaceSubmit({ name, link }) {\n    api.addCard({ name, link })\n      .then(res => {\n        const addedCardList = cards.concat(res)\n        setCards(addedCardList);\n        closeAllPopups();\n      })\n      .catch(err => console.log(err))\n  }\n\n  function openingInfoTooltip(kind) {\n    if (kind === false) {\n      setInfoTooltipText(\"Oops, something went wrong! Please try again.\");\n      setInfoTooltipImage(imageOopsPath);\n      setInfoTooltipOpen(true);\n    } else {\n      setInfoTooltipText(\"Success! You have now been registered.\");\n      setInfoTooltipImage(imageSuccessPath);\n      setInfoTooltipOpen(true);\n    }\n  }\n\n  function handleRegister(password, email) {\n    auth.register(password, email)\n      .then((res) => {\n        console.log(res);\n        if (!res || res.statusCode === 400) {\n          openingInfoTooltip(false);\n        } else {\n          openingInfoTooltip(true);\n          history.push(\"/login\");\n          return res;\n        }\n      })\n      .catch(err => openingInfoTooltip(false))\n  }\n\n  function handleLogin(password, email) {\n    auth.authorize(password, email)\n      .then((data) => {\n        if (data.token) {\n          setLoggedIn(true);\n          history.push(\"/\")\n        } else {\n          openingInfoTooltip(false);\n        }\n      })\n      .catch(err => openingInfoTooltip(false));\n\n  }\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n    <div className=\"page\">\n        <main>\n          <Switch>\n            <Route path=\"/signin\">\n              <Header \n                headerText={\"Sign up\"}\n                headerLink={\"/signup\"}\n              />\n              <Login \n                handleLogin={handleLogin}\n                openingInfoTooltip={openingInfoTooltip}\n                infoTooltipIsOpen={isInfoTooltipOpen}\n                onClose={closeAllPopups}\n                infoTooltipText={infoTooltipText}\n                infoTooltipImage={infoTooltipImage}\n              />\n            </Route>\n            <Route path=\"/signup\">\n              <Header\n                headerText={\"Log in\"}\n                headerLink={\"/signin\"}\n              />\n              <Register \n                openingInfoTooltip={openingInfoTooltip}\n                infoTooltipIsOpen={isInfoTooltipOpen}\n                onClose={closeAllPopups}\n                infoTooltipText={infoTooltipText}\n                infoTooltipImage={infoTooltipImage}\n                handleRegister={handleRegister}\n              />\n            </Route>\n            <ProtectedRoute path=\"/\"\n              loggedIn={loggedIn}\n              onEditProfile={() => {\n                setIsEditProfilePopupOpen(true);\n              }}\n              onAddPlace={() => {\n                setIsAddPlacePopupOpen(true);\n              }}\n              onEditAvatar={() => {\n                setIsEditAvatarPopupOpen(true);\n              }}\n              onCardClick={(card) => {\n                setIsImagePopupOpen(true);\n                setSelectedCardLink(card.card.link);\n                setSelectedCardName(card.card.name);\n              }}\n              editProfileIsOpen={isEditProfilePopupOpen}\n              editAvatarIsOpen={isEditAvatarPopupOpen}\n              addPlaceIsOpen={isAddPlacePopupOpen}\n              imagePopupIsOpen={isImagePopupOpen}\n              imageLink={selectedCardLink}\n              imageName={selectedCardName}\n              onClose={closeAllPopups}\n              onCardLike={handleCardLike}\n              onCardDelete={handleCardDelete}\n              cards={cards}\n              onSignOut={onSignOut}\n              userMail={userMail}\n              component={Main}\n              />\n          </Switch>\n        </main>\n        <EditProfilePopup isOpen={isEditProfilePopupOpen} onClose={closeAllPopups} onUpdateUser={handleUpdateUser} />\n        <EditAvatarPopup isOpen={isEditAvatarPopupOpen} onClose={closeAllPopups} onUpdateAvatar={handleUpdateAvatar} />\n        <AddPlacePopup isOpen={isAddPlacePopupOpen} onClose={closeAllPopups} onAddPlace={handleAddPlaceSubmit} />\n        <InfoTooltip isOpen={isInfoTooltipOpen} onClose={closeAllPopups} />\n        <InfoTooltip onClose={closeAllPopups} isOpen={isInfoTooltipOpen} infoTooltipText={infoTooltipText} infoTooltipImage={infoTooltipImage} />\n        <ImagePopup onClose={closeAllPopups} imagePopupIsOpened={isImagePopupOpen} cardName={selectedCardName} cardLink={selectedCardLink} />\n        <PopupWithForm name=\"delete-card\" buttonText=\"Yes\" title=\"Are you sure?\" \n          children={\n              <React.Fragment>\n              </React.Fragment>}\n          />\n    </div>\n    </CurrentUserContext.Provider>\n);\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}