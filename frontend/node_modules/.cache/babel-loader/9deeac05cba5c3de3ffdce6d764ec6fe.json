{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _slicedToArray from\"/Users/tanya/Dev/react-around-api-full/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import{Route,Switch,useHistory}from'react-router-dom';import Main from'./Main.js';import Header from'./Header.js';import Register from'./Register.js';import Login from'./Login.js';import ProtectedRoute from'./ProtectedRoute';import EditProfilePopup from'./EditProfilePopup.js';import EditAvatarPopup from'./EditAvatarPopup.js';import AddPlacePopup from'./AddPlacePopup.js';import PopupWithForm from'./PopupWithForm.js';import InfoTooltip from'./InfoTooltip.js';import imageSuccessPath from\"../images/success.png\";import imageOopsPath from'../images/oops.png';import ImagePopup from'./ImagePopup.js';import*as auth from'../auth.js';import api from'../utils/Api.js';import CurrentUserContext from'../contexts/CurrentUserContext.js';function App(){var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditProfilePopupOpen=_React$useState2[0],setIsEditProfilePopupOpen=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isAddPlacePopupOpen=_React$useState4[0],setIsAddPlacePopupOpen=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isEditAvatarPopupOpen=_React$useState6[0],setIsEditAvatarPopupOpen=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),isImagePopupOpen=_React$useState8[0],setIsImagePopupOpen=_React$useState8[1];var _React$useState9=React.useState(false),_React$useState10=_slicedToArray(_React$useState9,2),isInfoTooltipOpen=_React$useState10[0],setInfoTooltipOpen=_React$useState10[1];var _React$useState11=React.useState(\"\"),_React$useState12=_slicedToArray(_React$useState11,2),infoTooltipText=_React$useState12[0],setInfoTooltipText=_React$useState12[1];var _React$useState13=React.useState(\"#\"),_React$useState14=_slicedToArray(_React$useState13,2),infoTooltipImage=_React$useState14[0],setInfoTooltipImage=_React$useState14[1];var _React$useState15=React.useState([]),_React$useState16=_slicedToArray(_React$useState15,2),cards=_React$useState16[0],setCards=_React$useState16[1];var _React$useState17=React.useState(\"\"),_React$useState18=_slicedToArray(_React$useState17,2),selectedCardLink=_React$useState18[0],setSelectedCardLink=_React$useState18[1];var _React$useState19=React.useState(\"\"),_React$useState20=_slicedToArray(_React$useState19,2),selectedCardName=_React$useState20[0],setSelectedCardName=_React$useState20[1];var _React$useState21=React.useState({}),_React$useState22=_slicedToArray(_React$useState21,2),currentUser=_React$useState22[0],setCurrentUser=_React$useState22[1];var _React$useState23=React.useState(false),_React$useState24=_slicedToArray(_React$useState23,2),loggedIn=_React$useState24[0],setLoggedIn=_React$useState24[1];var history=useHistory();React.useEffect(function(){var jwt=localStorage.getItem('jwt');if(jwt){auth.checkToken(jwt).then(function(res){setLoggedIn(true);history.push(\"/\");}).catch(function(err){return console.log(err);});api.getCardList().then(function(res){setCards(res);}).catch(function(err){return console.log(err);});api.getUserInfo().then(function(res){setCurrentUser(res.data);}).catch(function(err){return console.log(err);});}},[loggedIn,history]);var onSignOut=function onSignOut(){localStorage.removeItem('jwt');setCards([]);setCurrentUser({});setLoggedIn(false);};function handleCardLike(card){var isLiked=card.card.likes.some(function(i){return i===currentUser._id;});api.changeLikeCardStatus(card.card._id,isLiked).then(function(newCard){var newCards=cards.map(function(c){return c._id===newCard.data._id?newCard.data:c;});setCards(newCards);}).catch(function(err){return console.log(err);});}function handleCardDelete(cardID){api.removeCard(cardID).then(function(res){var newCards=cards.filter(function(card){return card._id!==cardID;});setCards(newCards);}).catch(function(err){return console.log(err);});}function closeAllPopups(){setIsEditProfilePopupOpen(false);setIsAddPlacePopupOpen(false);setIsEditAvatarPopupOpen(false);setIsEditAvatarPopupOpen(false);setIsImagePopupOpen(false);setInfoTooltipOpen(false);}function handleUpdateUser(_ref){var name=_ref.name,title=_ref.title;api.setUserInfo({name:name,title:title}).then(function(res){closeAllPopups();setCurrentUser(res.data);}).catch(function(err){return console.log(err);});}function handleUpdateAvatar(avatar){api.setUserAvatar(avatar).then(function(res){closeAllPopups();setCurrentUser(res.data);}).catch(function(err){return console.log(err);});}function handleAddPlaceSubmit(_ref2){var name=_ref2.name,link=_ref2.link;api.addCard({name:name,link:link}).then(function(res){var addedCardList=cards.concat(res);setCards(addedCardList);closeAllPopups();}).catch(function(err){return console.log(err);});}function openingInfoTooltip(kind){if(kind===false){setInfoTooltipText(\"Oops, something went wrong! Please try again.\");setInfoTooltipImage(imageOopsPath);setInfoTooltipOpen(true);}else{setInfoTooltipText(\"Success! You have now been registered.\");setInfoTooltipImage(imageSuccessPath);setInfoTooltipOpen(true);}}function handleRegister(password,email){auth.register(password,email).then(function(res){if(!res||res.statusCode===400||res.statusCode===500||res.message===\"An error occurred on the server\"){openingInfoTooltip(false);}else{openingInfoTooltip(true);history.push(\"/login\");return res;}}).catch(function(err){return openingInfoTooltip(false);});}function handleLogin(password,email){auth.authorize(password,email).then(function(data){if(data[1]){localStorage.setItem(\"jwt\",data[1]);setLoggedIn(true);history.push(\"/\");}else{openingInfoTooltip(false);}}).catch(function(err){return openingInfoTooltip(false);});}return/*#__PURE__*/_jsx(CurrentUserContext.Provider,{value:currentUser,children:/*#__PURE__*/_jsxs(\"div\",{className:\"page\",children:[/*#__PURE__*/_jsx(\"main\",{children:/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsxs(Route,{path:\"/signin\",children:[/*#__PURE__*/_jsx(Header,{headerText:\"Sign up\",headerLink:\"/signup\"}),/*#__PURE__*/_jsx(Login,{handleLogin:handleLogin,openingInfoTooltip:openingInfoTooltip,infoTooltipIsOpen:isInfoTooltipOpen,onClose:closeAllPopups,infoTooltipText:infoTooltipText,infoTooltipImage:infoTooltipImage})]}),/*#__PURE__*/_jsxs(Route,{path:\"/signup\",children:[/*#__PURE__*/_jsx(Header,{headerText:\"Log in\",headerLink:\"/signin\"}),/*#__PURE__*/_jsx(Register,{openingInfoTooltip:openingInfoTooltip,infoTooltipIsOpen:isInfoTooltipOpen,onClose:closeAllPopups,infoTooltipText:infoTooltipText,infoTooltipImage:infoTooltipImage,handleRegister:handleRegister})]}),/*#__PURE__*/_jsx(ProtectedRoute,{path:\"/\",loggedIn:loggedIn,onEditProfile:function onEditProfile(){setIsEditProfilePopupOpen(true);},onAddPlace:function onAddPlace(){setIsAddPlacePopupOpen(true);},onEditAvatar:function onEditAvatar(){setIsEditAvatarPopupOpen(true);},onCardClick:function onCardClick(card){setIsImagePopupOpen(true);setSelectedCardLink(card.card.link);setSelectedCardName(card.card.name);},editProfileIsOpen:isEditProfilePopupOpen,editAvatarIsOpen:isEditAvatarPopupOpen,addPlaceIsOpen:isAddPlacePopupOpen,imagePopupIsOpen:isImagePopupOpen,imageLink:selectedCardLink,imageName:selectedCardName,onClose:closeAllPopups,onCardLike:handleCardLike,onCardDelete:handleCardDelete,cards:cards,onSignOut:onSignOut,component:Main})]})}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddPlace:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(InfoTooltip,{isOpen:isInfoTooltipOpen,onClose:closeAllPopups}),/*#__PURE__*/_jsx(InfoTooltip,{onClose:closeAllPopups,isOpen:isInfoTooltipOpen,infoTooltipText:infoTooltipText,infoTooltipImage:infoTooltipImage}),/*#__PURE__*/_jsx(ImagePopup,{onClose:closeAllPopups,imagePopupIsOpened:isImagePopupOpen,cardName:selectedCardName,cardLink:selectedCardLink}),/*#__PURE__*/_jsx(PopupWithForm,{name:\"delete-card\",buttonText:\"Yes\",title:\"Are you sure?\",children:/*#__PURE__*/_jsx(React.Fragment,{})})]})});}export default App;","map":{"version":3,"sources":["/Users/tanya/Dev/react-around-api-full/frontend/src/components/App.js"],"names":["React","Route","Switch","useHistory","Main","Header","Register","Login","ProtectedRoute","EditProfilePopup","EditAvatarPopup","AddPlacePopup","PopupWithForm","InfoTooltip","imageSuccessPath","imageOopsPath","ImagePopup","auth","api","CurrentUserContext","App","useState","isEditProfilePopupOpen","setIsEditProfilePopupOpen","isAddPlacePopupOpen","setIsAddPlacePopupOpen","isEditAvatarPopupOpen","setIsEditAvatarPopupOpen","isImagePopupOpen","setIsImagePopupOpen","isInfoTooltipOpen","setInfoTooltipOpen","infoTooltipText","setInfoTooltipText","infoTooltipImage","setInfoTooltipImage","cards","setCards","selectedCardLink","setSelectedCardLink","selectedCardName","setSelectedCardName","currentUser","setCurrentUser","loggedIn","setLoggedIn","history","useEffect","jwt","localStorage","getItem","checkToken","then","res","push","catch","err","console","log","getCardList","getUserInfo","data","onSignOut","removeItem","handleCardLike","card","isLiked","likes","some","i","_id","changeLikeCardStatus","newCard","newCards","map","c","handleCardDelete","cardID","removeCard","filter","closeAllPopups","handleUpdateUser","name","title","setUserInfo","handleUpdateAvatar","avatar","setUserAvatar","handleAddPlaceSubmit","link","addCard","addedCardList","concat","openingInfoTooltip","kind","handleRegister","password","email","register","statusCode","message","handleLogin","authorize","setItem"],"mappings":"8PAAA,MAAOA,CAAAA,KAAP,KAAkB,OAAlB,CACA,OAASC,KAAT,CAAgBC,MAAhB,CAAwBC,UAAxB,KAA0C,kBAA1C,CAEA,MAAOC,CAAAA,IAAP,KAAiB,WAAjB,CACA,MAAOC,CAAAA,MAAP,KAAmB,aAAnB,CACA,MAAOC,CAAAA,QAAP,KAAqB,eAArB,CACA,MAAOC,CAAAA,KAAP,KAAkB,YAAlB,CACA,MAAOC,CAAAA,cAAP,KAA2B,kBAA3B,CACA,MAAOC,CAAAA,gBAAP,KAA6B,uBAA7B,CACA,MAAOC,CAAAA,eAAP,KAA4B,sBAA5B,CACA,MAAOC,CAAAA,aAAP,KAA0B,oBAA1B,CACA,MAAOC,CAAAA,aAAP,KAA0B,oBAA1B,CACA,MAAOC,CAAAA,WAAP,KAAwB,kBAAxB,CACA,MAAOC,CAAAA,gBAAP,KAA6B,uBAA7B,CACA,MAAOC,CAAAA,aAAP,KAA0B,oBAA1B,CACA,MAAOC,CAAAA,UAAP,KAAuB,iBAAvB,CAEA,MAAO,GAAKC,CAAAA,IAAZ,KAAsB,YAAtB,CACA,MAAOC,CAAAA,GAAP,KAAgB,iBAAhB,CACA,MAAOC,CAAAA,kBAAP,KAA+B,mCAA/B,CAGA,QAASC,CAAAA,GAAT,EAAe,qBAE+CpB,KAAK,CAACqB,QAAN,CAAe,KAAf,CAF/C,oDAENC,sBAFM,qBAEkBC,yBAFlB,0CAGyCvB,KAAK,CAACqB,QAAN,CAAe,KAAf,CAHzC,qDAGNG,mBAHM,qBAGeC,sBAHf,0CAI6CzB,KAAK,CAACqB,QAAN,CAAe,KAAf,CAJ7C,qDAINK,qBAJM,qBAIiBC,wBAJjB,0CAKmC3B,KAAK,CAACqB,QAAN,CAAe,KAAf,CALnC,qDAKNO,gBALM,qBAKYC,mBALZ,0CAMmC7B,KAAK,CAACqB,QAAN,CAAe,KAAf,CANnC,sDAMNS,iBANM,sBAMaC,kBANb,4CAOiC/B,KAAK,CAACqB,QAAN,CAAe,EAAf,CAPjC,uDAONW,eAPM,sBAOWC,kBAPX,4CAQmCjC,KAAK,CAACqB,QAAN,CAAe,GAAf,CARnC,uDAQNa,gBARM,sBAQYC,mBARZ,4CAUanC,KAAK,CAACqB,QAAN,CAAe,EAAf,CAVb,uDAUNe,KAVM,sBAUCC,QAVD,4CAWmCrC,KAAK,CAACqB,QAAN,CAAe,EAAf,CAXnC,uDAWNiB,gBAXM,sBAWYC,mBAXZ,4CAYmCvC,KAAK,CAACqB,QAAN,CAAe,EAAf,CAZnC,uDAYNmB,gBAZM,sBAYYC,mBAZZ,4CAcyBzC,KAAK,CAACqB,QAAN,CAAe,EAAf,CAdzB,uDAcNqB,WAdM,sBAcOC,cAdP,4CAemB3C,KAAK,CAACqB,QAAN,CAAe,KAAf,CAfnB,uDAeNuB,QAfM,sBAeIC,WAfJ,sBAgBb,GAAMC,CAAAA,OAAO,CAAG3C,UAAU,EAA1B,CAEAH,KAAK,CAAC+C,SAAN,CAAgB,UAAM,CACpB,GAAMC,CAAAA,GAAG,CAAGC,YAAY,CAACC,OAAb,CAAqB,KAArB,CAAZ,CACA,GAAIF,GAAJ,CAAS,CACP/B,IAAI,CAACkC,UAAL,CAAgBH,GAAhB,EACCI,IADD,CACM,SAACC,GAAD,CAAS,CACbR,WAAW,CAAC,IAAD,CAAX,CACAC,OAAO,CAACQ,IAAR,CAAa,GAAb,EACD,CAJD,EAKCC,KALD,CAKO,SAAAC,GAAG,QAAIC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAJ,EALV,EAMAtC,GAAG,CAACyC,WAAJ,GACGP,IADH,CACQ,SAAAC,GAAG,CAAI,CACXhB,QAAQ,CAACgB,GAAD,CAAR,CACD,CAHH,EAIGE,KAJH,CAIS,SAAAC,GAAG,QAAIC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAJ,EAJZ,EAKAtC,GAAG,CAAC0C,WAAJ,GACGR,IADH,CACQ,SAAAC,GAAG,CAAI,CACXV,cAAc,CAACU,GAAG,CAACQ,IAAL,CAAd,CACD,CAHH,EAIGN,KAJH,CAIS,SAAAC,GAAG,QAAIC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAJ,EAJZ,EAKD,CACF,CApBD,CAoBG,CAACZ,QAAD,CAAWE,OAAX,CApBH,EAsBA,GAAMgB,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,EAAM,CACtBb,YAAY,CAACc,UAAb,CAAwB,KAAxB,EACA1B,QAAQ,CAAC,EAAD,CAAR,CACAM,cAAc,CAAC,EAAD,CAAd,CACAE,WAAW,CAAC,KAAD,CAAX,CACD,CALD,CAOA,QAASmB,CAAAA,cAAT,CAAwBC,IAAxB,CAA8B,CAC5B,GAAMC,CAAAA,OAAO,CAAGD,IAAI,CAACA,IAAL,CAAUE,KAAV,CAAgBC,IAAhB,CAAqB,SAAAC,CAAC,QAAIA,CAAAA,CAAC,GAAK3B,WAAW,CAAC4B,GAAtB,EAAtB,CAAhB,CACApD,GAAG,CAACqD,oBAAJ,CAAyBN,IAAI,CAACA,IAAL,CAAUK,GAAnC,CAAwCJ,OAAxC,EACGd,IADH,CACQ,SAACoB,OAAD,CAAa,CACjB,GAAMC,CAAAA,QAAQ,CAAGrC,KAAK,CAACsC,GAAN,CAAU,SAACC,CAAD,QAAOA,CAAAA,CAAC,CAACL,GAAF,GAAUE,OAAO,CAACX,IAAR,CAAaS,GAAvB,CAA6BE,OAAO,CAACX,IAArC,CAA4Cc,CAAnD,EAAV,CAAjB,CACAtC,QAAQ,CAACoC,QAAD,CAAR,CACH,CAJD,EAKGlB,KALH,CAKS,SAAAC,GAAG,QAAIC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAJ,EALZ,EAMD,CAED,QAASoB,CAAAA,gBAAT,CAA0BC,MAA1B,CAAkC,CAChC3D,GAAG,CAAC4D,UAAJ,CAAeD,MAAf,EACCzB,IADD,CACM,SAAAC,GAAG,CAAI,CACX,GAAMoB,CAAAA,QAAQ,CAAGrC,KAAK,CAAC2C,MAAN,CAAa,SAAAd,IAAI,QAAIA,CAAAA,IAAI,CAACK,GAAL,GAAaO,MAAjB,EAAjB,CAAjB,CACAxC,QAAQ,CAACoC,QAAD,CAAR,CACD,CAJD,EAKClB,KALD,CAKO,SAAAC,GAAG,QAAIC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAJ,EALV,EAMD,CAED,QAASwB,CAAAA,cAAT,EAA0B,CACxBzD,yBAAyB,CAAC,KAAD,CAAzB,CACAE,sBAAsB,CAAC,KAAD,CAAtB,CACAE,wBAAwB,CAAC,KAAD,CAAxB,CACAA,wBAAwB,CAAC,KAAD,CAAxB,CACAE,mBAAmB,CAAC,KAAD,CAAnB,CACAE,kBAAkB,CAAC,KAAD,CAAlB,CACD,CAED,QAASkD,CAAAA,gBAAT,MAAyC,IAAdC,CAAAA,IAAc,MAAdA,IAAc,CAARC,KAAQ,MAARA,KAAQ,CACvCjE,GAAG,CAACkE,WAAJ,CAAgB,CAAEF,IAAI,CAAJA,IAAF,CAAQC,KAAK,CAALA,KAAR,CAAhB,EACG/B,IADH,CACQ,SAAAC,GAAG,CAAI,CACX2B,cAAc,GACdrC,cAAc,CAACU,GAAG,CAACQ,IAAL,CAAd,CACD,CAJH,EAKGN,KALH,CAKS,SAAAC,GAAG,QAAIC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAJ,EALZ,EAMD,CAED,QAAS6B,CAAAA,kBAAT,CAA4BC,MAA5B,CAAoC,CAClCpE,GAAG,CAACqE,aAAJ,CAAkBD,MAAlB,EACGlC,IADH,CACQ,SAAAC,GAAG,CAAI,CACX2B,cAAc,GACdrC,cAAc,CAACU,GAAG,CAACQ,IAAL,CAAd,CACD,CAJH,EAKGN,KALH,CAKS,SAAAC,GAAG,QAAIC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAJ,EALZ,EAMD,CAED,QAASgC,CAAAA,oBAAT,OAA8C,IAAdN,CAAAA,IAAc,OAAdA,IAAc,CAARO,IAAQ,OAARA,IAAQ,CAC5CvE,GAAG,CAACwE,OAAJ,CAAY,CAAER,IAAI,CAAJA,IAAF,CAAQO,IAAI,CAAJA,IAAR,CAAZ,EACGrC,IADH,CACQ,SAAAC,GAAG,CAAI,CACX,GAAMsC,CAAAA,aAAa,CAAGvD,KAAK,CAACwD,MAAN,CAAavC,GAAb,CAAtB,CACAhB,QAAQ,CAACsD,aAAD,CAAR,CACAX,cAAc,GACf,CALH,EAMGzB,KANH,CAMS,SAAAC,GAAG,QAAIC,CAAAA,OAAO,CAACC,GAAR,CAAYF,GAAZ,CAAJ,EANZ,EAOD,CAED,QAASqC,CAAAA,kBAAT,CAA4BC,IAA5B,CAAkC,CAChC,GAAIA,IAAI,GAAK,KAAb,CAAoB,CAClB7D,kBAAkB,CAAC,+CAAD,CAAlB,CACAE,mBAAmB,CAACpB,aAAD,CAAnB,CACAgB,kBAAkB,CAAC,IAAD,CAAlB,CACD,CAJD,IAIO,CACLE,kBAAkB,CAAC,wCAAD,CAAlB,CACAE,mBAAmB,CAACrB,gBAAD,CAAnB,CACAiB,kBAAkB,CAAC,IAAD,CAAlB,CACD,CACF,CAED,QAASgE,CAAAA,cAAT,CAAwBC,QAAxB,CAAkCC,KAAlC,CAAyC,CACvChF,IAAI,CAACiF,QAAL,CAAcF,QAAd,CAAwBC,KAAxB,EACG7C,IADH,CACQ,SAACC,GAAD,CAAS,CACb,GAAI,CAACA,GAAD,EAAQA,GAAG,CAAC8C,UAAJ,GAAmB,GAA3B,EAAkC9C,GAAG,CAAC8C,UAAJ,GAAmB,GAArD,EAA4D9C,GAAG,CAAC+C,OAAJ,GAAgB,iCAAhF,CAAmH,CACjHP,kBAAkB,CAAC,KAAD,CAAlB,CACD,CAFD,IAEO,CACLA,kBAAkB,CAAC,IAAD,CAAlB,CACA/C,OAAO,CAACQ,IAAR,CAAa,QAAb,EACA,MAAOD,CAAAA,GAAP,CACD,CACF,CATH,EAUGE,KAVH,CAUS,SAAAC,GAAG,QAAIqC,CAAAA,kBAAkB,CAAC,KAAD,CAAtB,EAVZ,EAWD,CAED,QAASQ,CAAAA,WAAT,CAAqBL,QAArB,CAA+BC,KAA/B,CAAsC,CACpChF,IAAI,CAACqF,SAAL,CAAeN,QAAf,CAAyBC,KAAzB,EACG7C,IADH,CACQ,SAACS,IAAD,CAAU,CACd,GAAIA,IAAI,CAAC,CAAD,CAAR,CAAa,CACXZ,YAAY,CAACsD,OAAb,CAAqB,KAArB,CAA4B1C,IAAI,CAAC,CAAD,CAAhC,EACAhB,WAAW,CAAC,IAAD,CAAX,CACAC,OAAO,CAACQ,IAAR,CAAa,GAAb,EACD,CAJD,IAIO,CACLuC,kBAAkB,CAAC,KAAD,CAAlB,CACD,CACF,CATH,EAUGtC,KAVH,CAUS,SAAAC,GAAG,QAAIqC,CAAAA,kBAAkB,CAAC,KAAD,CAAtB,EAVZ,EAYD,CAED,mBACE,KAAC,kBAAD,CAAoB,QAApB,EAA6B,KAAK,CAAEnD,WAApC,uBACA,aAAK,SAAS,CAAC,MAAf,wBACI,mCACE,MAAC,MAAD,yBACE,MAAC,KAAD,EAAO,IAAI,CAAC,SAAZ,wBACE,KAAC,MAAD,EACE,UAAU,CAAE,SADd,CAEE,UAAU,CAAE,SAFd,EADF,cAKE,KAAC,KAAD,EACE,WAAW,CAAE2D,WADf,CAEE,kBAAkB,CAAER,kBAFtB,CAGE,iBAAiB,CAAE/D,iBAHrB,CAIE,OAAO,CAAEkD,cAJX,CAKE,eAAe,CAAEhD,eALnB,CAME,gBAAgB,CAAEE,gBANpB,EALF,GADF,cAeE,MAAC,KAAD,EAAO,IAAI,CAAC,SAAZ,wBACE,KAAC,MAAD,EACE,UAAU,CAAE,QADd,CAEE,UAAU,CAAE,SAFd,EADF,cAKE,KAAC,QAAD,EACE,kBAAkB,CAAE2D,kBADtB,CAEE,iBAAiB,CAAE/D,iBAFrB,CAGE,OAAO,CAAEkD,cAHX,CAIE,eAAe,CAAEhD,eAJnB,CAKE,gBAAgB,CAAEE,gBALpB,CAME,cAAc,CAAE6D,cANlB,EALF,GAfF,cA6BE,KAAC,cAAD,EAAgB,IAAI,CAAC,GAArB,CACE,QAAQ,CAAEnD,QADZ,CAEE,aAAa,CAAE,wBAAM,CACnBrB,yBAAyB,CAAC,IAAD,CAAzB,CACD,CAJH,CAKE,UAAU,CAAE,qBAAM,CAChBE,sBAAsB,CAAC,IAAD,CAAtB,CACD,CAPH,CAQE,YAAY,CAAE,uBAAM,CAClBE,wBAAwB,CAAC,IAAD,CAAxB,CACD,CAVH,CAWE,WAAW,CAAE,qBAACsC,IAAD,CAAU,CACrBpC,mBAAmB,CAAC,IAAD,CAAnB,CACAU,mBAAmB,CAAC0B,IAAI,CAACA,IAAL,CAAUwB,IAAX,CAAnB,CACAhD,mBAAmB,CAACwB,IAAI,CAACA,IAAL,CAAUiB,IAAX,CAAnB,CACD,CAfH,CAgBE,iBAAiB,CAAE5D,sBAhBrB,CAiBE,gBAAgB,CAAEI,qBAjBpB,CAkBE,cAAc,CAAEF,mBAlBlB,CAmBE,gBAAgB,CAAEI,gBAnBpB,CAoBE,SAAS,CAAEU,gBApBb,CAqBE,SAAS,CAAEE,gBArBb,CAsBE,OAAO,CAAEwC,cAtBX,CAuBE,UAAU,CAAEhB,cAvBd,CAwBE,YAAY,CAAEY,gBAxBhB,CAyBE,KAAK,CAAExC,KAzBT,CA0BE,SAAS,CAAE0B,SA1Bb,CA2BE,SAAS,CAAE1D,IA3Bb,EA7BF,GADF,EADJ,cA8DI,KAAC,gBAAD,EAAkB,MAAM,CAAEkB,sBAA1B,CAAkD,OAAO,CAAE0D,cAA3D,CAA2E,YAAY,CAAEC,gBAAzF,EA9DJ,cA+DI,KAAC,eAAD,EAAiB,MAAM,CAAEvD,qBAAzB,CAAgD,OAAO,CAAEsD,cAAzD,CAAyE,cAAc,CAAEK,kBAAzF,EA/DJ,cAgEI,KAAC,aAAD,EAAe,MAAM,CAAE7D,mBAAvB,CAA4C,OAAO,CAAEwD,cAArD,CAAqE,UAAU,CAAEQ,oBAAjF,EAhEJ,cAiEI,KAAC,WAAD,EAAa,MAAM,CAAE1D,iBAArB,CAAwC,OAAO,CAAEkD,cAAjD,EAjEJ,cAkEI,KAAC,WAAD,EAAa,OAAO,CAAEA,cAAtB,CAAsC,MAAM,CAAElD,iBAA9C,CAAiE,eAAe,CAAEE,eAAlF,CAAmG,gBAAgB,CAAEE,gBAArH,EAlEJ,cAmEI,KAAC,UAAD,EAAY,OAAO,CAAE8C,cAArB,CAAqC,kBAAkB,CAAEpD,gBAAzD,CAA2E,QAAQ,CAAEY,gBAArF,CAAuG,QAAQ,CAAEF,gBAAjH,EAnEJ,cAoEI,KAAC,aAAD,EAAe,IAAI,CAAC,aAApB,CAAkC,UAAU,CAAC,KAA7C,CAAmD,KAAK,CAAC,eAAzD,CACE,QAAQ,cACJ,KAAC,KAAD,CAAO,QAAP,IAFN,EApEJ,GADA,EADF,CA8ED,CAED,cAAelB,CAAAA,GAAf","sourcesContent":["import React from 'react';\nimport { Route, Switch, useHistory } from 'react-router-dom';\n\nimport Main from './Main.js';\nimport Header from './Header.js';\nimport Register from './Register.js';\nimport Login from './Login.js';\nimport ProtectedRoute from './ProtectedRoute';\nimport EditProfilePopup from './EditProfilePopup.js';\nimport EditAvatarPopup from './EditAvatarPopup.js';\nimport AddPlacePopup from './AddPlacePopup.js';\nimport PopupWithForm from './PopupWithForm.js';\nimport InfoTooltip from './InfoTooltip.js';\nimport imageSuccessPath from \"../images/success.png\";\nimport imageOopsPath from '../images/oops.png';\nimport ImagePopup from './ImagePopup.js';\n\nimport * as auth from '../auth.js';\nimport api from '../utils/Api.js';\nimport CurrentUserContext from '../contexts/CurrentUserContext.js';\n\n\nfunction App() {\n\n  const [isEditProfilePopupOpen, setIsEditProfilePopupOpen] = React.useState(false);\n  const [isAddPlacePopupOpen, setIsAddPlacePopupOpen] = React.useState(false);\n  const [isEditAvatarPopupOpen, setIsEditAvatarPopupOpen] = React.useState(false);\n  const [isImagePopupOpen, setIsImagePopupOpen] = React.useState(false);\n  const [isInfoTooltipOpen, setInfoTooltipOpen] = React.useState(false);\n  const [infoTooltipText, setInfoTooltipText] = React.useState(\"\");\n  const [infoTooltipImage, setInfoTooltipImage] = React.useState(\"#\");\n\n  const [cards, setCards] = React.useState([]);\n  const [selectedCardLink, setSelectedCardLink] = React.useState(\"\");\n  const [selectedCardName, setSelectedCardName] = React.useState(\"\");\n\n  const [currentUser, setCurrentUser] = React.useState({});\n  const [loggedIn, setLoggedIn] = React.useState(false);\n  const history = useHistory();\n\n  React.useEffect(() => {\n    const jwt = localStorage.getItem('jwt');\n    if (jwt) {\n      auth.checkToken(jwt)\n      .then((res) => {\n        setLoggedIn(true);\n        history.push(\"/\");\n      })\n      .catch(err => console.log(err));\n      api.getCardList()\n        .then(res => {\n          setCards(res);\n        })\n        .catch(err => console.log(err))\n      api.getUserInfo()\n        .then(res => {\n          setCurrentUser(res.data);\n        })\n        .catch(err => console.log(err));\n    }\n  }, [loggedIn, history]);\n\n  const onSignOut = () => {\n    localStorage.removeItem('jwt');\n    setCards([]);\n    setCurrentUser({});\n    setLoggedIn(false);\n  }\n\n  function handleCardLike(card) {\n    const isLiked = card.card.likes.some(i => i === currentUser._id);\n    api.changeLikeCardStatus(card.card._id, isLiked)\n      .then((newCard) => {\n        const newCards = cards.map((c) => c._id === newCard.data._id ? newCard.data : c);\n        setCards(newCards);\n    })\n      .catch(err => console.log(err));\n  }\n\n  function handleCardDelete(cardID) {\n    api.removeCard(cardID)\n    .then(res => {\n      const newCards = cards.filter(card => card._id !== cardID);\n      setCards(newCards);\n    })\n    .catch(err => console.log(err));\n  }\n\n  function closeAllPopups() {\n    setIsEditProfilePopupOpen(false);\n    setIsAddPlacePopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsEditAvatarPopupOpen(false);\n    setIsImagePopupOpen(false);\n    setInfoTooltipOpen(false);\n  }\n\n  function handleUpdateUser({name, title}) {\n    api.setUserInfo({ name, title})\n      .then(res => {\n        closeAllPopups();\n        setCurrentUser(res.data);\n      })\n      .catch(err => console.log(err))\n  }\n\n  function handleUpdateAvatar(avatar) {\n    api.setUserAvatar(avatar)\n      .then(res => {\n        closeAllPopups();\n        setCurrentUser(res.data);\n      })\n      .catch(err => console.log(err))\n  }\n\n  function handleAddPlaceSubmit({ name, link }) {\n    api.addCard({ name, link })\n      .then(res => {\n        const addedCardList = cards.concat(res)\n        setCards(addedCardList);\n        closeAllPopups();\n      })\n      .catch(err => console.log(err))\n  }\n\n  function openingInfoTooltip(kind) {\n    if (kind === false) {\n      setInfoTooltipText(\"Oops, something went wrong! Please try again.\");\n      setInfoTooltipImage(imageOopsPath);\n      setInfoTooltipOpen(true);\n    } else {\n      setInfoTooltipText(\"Success! You have now been registered.\");\n      setInfoTooltipImage(imageSuccessPath);\n      setInfoTooltipOpen(true);\n    }\n  }\n\n  function handleRegister(password, email) {\n    auth.register(password, email)\n      .then((res) => {\n        if (!res || res.statusCode === 400 || res.statusCode === 500 || res.message === \"An error occurred on the server\") {\n          openingInfoTooltip(false);\n        } else {\n          openingInfoTooltip(true);\n          history.push(\"/login\");\n          return res;\n        }\n      })\n      .catch(err => openingInfoTooltip(false))\n  }\n\n  function handleLogin(password, email) {\n    auth.authorize(password, email)\n      .then((data) => {\n        if (data[1]) {\n          localStorage.setItem(\"jwt\", data[1]);\n          setLoggedIn(true);\n          history.push(\"/\")\n        } else {\n          openingInfoTooltip(false);\n        }\n      })\n      .catch(err => openingInfoTooltip(false));\n\n  }\n\n  return (\n    <CurrentUserContext.Provider value={currentUser}>\n    <div className=\"page\">\n        <main>\n          <Switch>\n            <Route path=\"/signin\">\n              <Header \n                headerText={\"Sign up\"}\n                headerLink={\"/signup\"}\n              />\n              <Login \n                handleLogin={handleLogin}\n                openingInfoTooltip={openingInfoTooltip}\n                infoTooltipIsOpen={isInfoTooltipOpen}\n                onClose={closeAllPopups}\n                infoTooltipText={infoTooltipText}\n                infoTooltipImage={infoTooltipImage}\n              />\n            </Route>\n            <Route path=\"/signup\">\n              <Header\n                headerText={\"Log in\"}\n                headerLink={\"/signin\"}\n              />\n              <Register \n                openingInfoTooltip={openingInfoTooltip}\n                infoTooltipIsOpen={isInfoTooltipOpen}\n                onClose={closeAllPopups}\n                infoTooltipText={infoTooltipText}\n                infoTooltipImage={infoTooltipImage}\n                handleRegister={handleRegister}\n              />\n            </Route>\n            <ProtectedRoute path=\"/\"\n              loggedIn={loggedIn}\n              onEditProfile={() => {\n                setIsEditProfilePopupOpen(true);\n              }}\n              onAddPlace={() => {\n                setIsAddPlacePopupOpen(true);\n              }}\n              onEditAvatar={() => {\n                setIsEditAvatarPopupOpen(true);\n              }}\n              onCardClick={(card) => {\n                setIsImagePopupOpen(true);\n                setSelectedCardLink(card.card.link);\n                setSelectedCardName(card.card.name);\n              }}\n              editProfileIsOpen={isEditProfilePopupOpen}\n              editAvatarIsOpen={isEditAvatarPopupOpen}\n              addPlaceIsOpen={isAddPlacePopupOpen}\n              imagePopupIsOpen={isImagePopupOpen}\n              imageLink={selectedCardLink}\n              imageName={selectedCardName}\n              onClose={closeAllPopups}\n              onCardLike={handleCardLike}\n              onCardDelete={handleCardDelete}\n              cards={cards}\n              onSignOut={onSignOut}\n              component={Main}\n              />\n          </Switch>\n        </main>\n        <EditProfilePopup isOpen={isEditProfilePopupOpen} onClose={closeAllPopups} onUpdateUser={handleUpdateUser} />\n        <EditAvatarPopup isOpen={isEditAvatarPopupOpen} onClose={closeAllPopups} onUpdateAvatar={handleUpdateAvatar} />\n        <AddPlacePopup isOpen={isAddPlacePopupOpen} onClose={closeAllPopups} onAddPlace={handleAddPlaceSubmit} />\n        <InfoTooltip isOpen={isInfoTooltipOpen} onClose={closeAllPopups} />\n        <InfoTooltip onClose={closeAllPopups} isOpen={isInfoTooltipOpen} infoTooltipText={infoTooltipText} infoTooltipImage={infoTooltipImage} />\n        <ImagePopup onClose={closeAllPopups} imagePopupIsOpened={isImagePopupOpen} cardName={selectedCardName} cardLink={selectedCardLink} />\n        <PopupWithForm name=\"delete-card\" buttonText=\"Yes\" title=\"Are you sure?\" \n          children={\n              <React.Fragment>\n              </React.Fragment>}\n          />\n    </div>\n    </CurrentUserContext.Provider>\n);\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}